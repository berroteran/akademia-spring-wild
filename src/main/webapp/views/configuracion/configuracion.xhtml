<ui:composition template="../../templates/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">


    <ui:define name="head">
        <style type="text/css">
            body .ui-fieldset .ui-fieldset-legend {
                border: none;
            }

            body .ui-datatable thead th .ui-column-title {
                font-weight: 800;
            }
        </style>
    </ui:define>


    <ui:define name="title">Configuraciones</ui:define>

    <ui:define name="content">


        <h:form id="formConfiguraciones" onkeypress="if (event.keyCode === 13) { return false; }" header="xxx">

            <p:tabView id="tabviewConfiguracion" activeIndex="0" dynamic="true">

                <p:tab id="tabProv" title="Proveedores">
                    <p:panelGrid columns="2" columnClasses="p-col-6,p-col-6">
                        <p:fieldset legend="Plan de compensacion">

                            <p:panelGrid >

                                <p:row>
                                    <p:column>
                                        Minimo del estimado anual para pagar:
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtMinimoEstimadoAnual"
                                                       style="width: 75px;"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="#{configuracionBackBean.params.get( configuracionBackBean.findIndex('REINTEGRO_MINIMO_PAGO_PCT') ).valor}"/>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column>Porcentaje excedente permitido:</p:column>
                                    <p:column>
                                        <p:inputNumber id="txtPorcentajeExcedente"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="#{configuracionBackBean.params.get( configuracionBackBean.findIndex('COMPRA_LIMITE_INCREMENTO_PCT') ).valor}"></p:inputNumber>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column>.</p:column>
                                    <p:column>.</p:column>
                                </p:row>

                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="width: 75px;"
                                                       value="Producto BABA. porcentaje consideracion para estimado Anual"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtPorcentajeBABAParaEstimadoAnual"
                                                       widgetVar="txtPorcentajeBABAParaEstimadoAnual"
                                                       style="width: 75px;"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="#{configuracionBackBean.params.get( configuracionBackBean.findIndex('PROYECTADO_BABA_PROPORCION') ).valor}"/>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column colspan="2">
                                        <p:commandButton icon="fa fa-save" value="Guardar"/>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>

                        </p:fieldset>

                        <p:panel style="width: 100%;height: 100%">
                            <p:dataTable id="table-razones"
                                         widgetVar="table-razones"
                                         emptyMessage="No se encontraron registros .."
                                         value="#{configuracionBackBean.listaBajaRazon}"
                                         selection="#{configuracionBackBean.razon}"
                                         var="razon"
                                         rowKey="#{configuracionBackBean.listaBajaRazon.indexOf(razon)}"
                                         rowIndexVar="rowIndex"
                                         scrollable="true"
                                         scrollHeight="200"
                                         selectionMode="single">

                                <f:facet name="header">
                                    <div class="ui-g" style="background: #7F8D93">
                                        <div class="ui-g-6" style="margin: auto;">
                                            <h4>
                                                <h:outputText value="Razones de Baja"/>
                                            </h4>
                                        </div>
                                        <div class="ui-g-6 content-align-right">
                                            <p:commandButton value="Agregar razon"
                                                             icon="fa fa-plus"
                                                             process="@this"
                                                             actionListener="#{configuracionBackBean.crearRazon()}"
                                                             update="table-razones dModalRazon"
                                                             oncomplete="PF('dModalRazon').show()"
                                                             style="margin: 0.1em"/>
                                        </div>
                                    </div>
                                </f:facet>

                                <p:ajax event="rowDblselect"
                                        listener="#{configuracionBackBean.onRazoneSelect}"
                                        update=":frmFormRazon"
                                        oncomplete="PF('dModalRazon').show()"/>


                                <p:column headerText="#" width="50" style="text-align: right;">
                                    <h:outputText value="#{rowIndex+1}"/>
                                </p:column>
                                <p:column headerText="Razon" width="300" style="text-align: left;">
                                    <h:outputText value="#{razon.razon}"/>
                                </p:column>
                                <p:column headerText="P. Positivo" width="70" style="text-align: left;">
                                    <h:outputText value="#{razon.positivo}"/>
                                </p:column>

                                <p:column headerText="Estado" width="70" style="text-align: left;">
                                    <h:outputText value="#{razon.activo}"/>
                                </p:column>
                                <p:column headerText="-" width="50">
                                </p:column>
                                <p:column headerText="-" width="50">
                                </p:column>
                            </p:dataTable>
                        </p:panel>

                        <p:fieldset legend="Estimados y proyectados">
                            <p:panelGrid>
                            </p:panelGrid>
                        </p:fieldset>

                        <p:fieldset title="Programa Organico" legend="Programa Organico">
                            <p:panelGrid columns="2">
                                <p:outputLabel style="width: 75px;" value="Años para volver a  ser orgánico"/>
                                <p:inputText id="txtlimiteO" style="width: 75px;" value="3"/>
                            </p:panelGrid>
                        </p:fieldset>

                    </p:panelGrid>
                </p:tab>


                <p:tab title="Atenciones y Compras">

                    <p:panelGrid columns="3">

                        <p:fieldset legend="Atenciones">

                            <p:panelGrid>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="width: 75px;"
                                                       value="Limite Considerar Tara para el peso Neto"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtLimiteTara"
                                                       style=""
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="100"/>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="width: 75px;"
                                                       value="Exigir Repesado en Oficina si menor a:"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtLimiteRepesadoCampo"
                                                       widgetVar="txtLimiteRepesadoCampo"
                                                       style=""
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       var="txtLimiteRepesadoCampo"
                                                       value="#{configuracionBackBean.params.get( configuracionBackBean.findIndex('COMPRA_LIMITE_REPESADO') ).valor}">
                                            <p:ajax event="change"
                                                    update="txtLimiteRepesadoCampo"
                                                    process="txtLimiteRepesadoCampo"
                                                    disabled="true"
                                                    listener="#{configuracionBackBean.saveParametro('COMPRA_LIMITE_REPESADO', txtLimiteRepesadoCampo)}"/>
                                        </p:inputNumber>
                                    </p:column>
                                    <p:column>

                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="txtlimitediffneg" style="width: 75px;"
                                                       value="Limite diferencia negativa permitida:"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtlimitediffneg"
                                                       style=""
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="5"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="txtLimiteEstimadoAnual" style="width: 75px;"
                                                       value="Permitir compras por debajo del estimado anual:"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtLimiteEstimadoAnual"
                                                       style=""
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="756.00"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column><p:outputLabel for="txtCompraCampoLimitePeso" style="width: 75px;"
                                                             value="Limite de Peso Compra en Campo."/></p:column>
                                    <p:column>
                                        <p:inputNumber id="txtCompraCampoLimitePeso"
                                                       maxlength="5"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="100"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="width: 75px;" value="Limite Merma.(Enviar Correo)"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtLimiteMerma"
                                                       style="width: 75px;"
                                                       maxlength="5"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="1.00"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column><p:outputLabel for="txtUIT" style="width: 75px;"
                                                             value="Limite UIT"/></p:column>
                                    <p:column>
                                        <p:inputNumber id="txtUIT"
                                                       maxlength="5"
                                                       minValue="0"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="756.00"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="width: 75px;"
                                                       value="Limite para afectar Peso Neto por Tara"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtLimitePesoNetoTara"
                                                       maxlength="5"
                                                       minValue="0"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       value="100"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:commandButton icon="fa fa-save" value="Guardar"
                                                         actionListener="#{configuracionBackBean.saveAllSettings()}"/>
                                    </p:column>
                                    <p:column></p:column>
                                </p:row>
                                <p:row>
                                    <p:column></p:column>
                                    <p:column></p:column>
                                </p:row>
                                <p:row>
                                    <p:column></p:column>
                                    <p:column></p:column>
                                </p:row>

                            </p:panelGrid>

                        </p:fieldset>

                        <p:fieldset title="" legend="Alerta y notificaciones (Porcentaje de notificación)">
                            <p:panelGrid columns="1">
                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="width: 75px;"
                                                       value="Limite 1er Aviso estimado Anual"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtlimiteprimerAvisoEstimadoAnual" style="width: 75px;"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       var="txtLimiteRepesadoCampo"
                                                       value="#{configuracionBackBean.params.get( configuracionBackBean.findIndex('COMPRA_PORCENTAJE_AVANCE_AVISO1') ).valor}"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="width: 75px;"
                                                       value="Limite 2do Aviso estimado Anual"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtLimiteSegundoAvisoEstimadoAnual" style="width: 75px;"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       var="txtLimiteRepesadoCampo"
                                                       value="#{configuracionBackBean.params.get( configuracionBackBean.findIndex('COMPRA_PORCENTAJE_AVANCE_AVISO2') ).valor}"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="width: 75px;"
                                                       value="Limite 3er Aviso estimado Anual (Rojo)"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputNumber id="txtLimiteTercerAvisoEstimadoAnual" style="width: 75px;"
                                                       inputStyle="text-align: right;width: 100px;"
                                                       maxlength="5"
                                                       minValue="0"
                                                       decimalSeparator="."
                                                       thousandSeparator=","
                                                       maxValue="5000"
                                                       var="txtLimiteRepesadoCampo"
                                                       value="#{configuracionBackBean.params.get( configuracionBackBean.findIndex('COMPRA_PORCENTAJE_AVANCE_AVISO3') ).valor}"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="2">
                                        <p:commandButton icon="fa fa-save" value="Guardar"
                                                         actionListener="#{configuracionBackBean.saveAllSettings()}"/>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>
                        </p:fieldset>

                        <p:panelGrid>

                            <p:fieldset legend="Compras">

                                <p:row>
                                    <p:column><p:outputLabel value="Precio Sugerido"/></p:column>
                                    <p:column><p:inputNumber id="txtPrecioSugerido" value="8"/></p:column>
                                </p:row>
                                <p:row>
                                    <p:column><p:outputLabel value="Margen del Precio"/></p:column>
                                    <p:column><p:inputNumber value="10"/></p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:commandButton icon="fa fa-save" value="Guardar"
                                                         actionListener="#{configuracionBackBean.saveAllSettings()}"/>
                                    </p:column>
                                </p:row>
                            </p:fieldset>
                        </p:panelGrid>

                    </p:panelGrid>

                </p:tab>

                <p:tab id="tabCorreo" title=":: Correo" icon="fa fa-signal">

                    <p:fieldset legend="Datos de configuración de la cuenta">
                        <p:panelGrid columns="12" contentStyleClass="p-align-baseline ui-fluid">

                            <p:outputLabel for="txtServidor" value="Servidor" style="width: 100px;"/>
                            <p:inputText id="txtServidor" value="#{configuracionBackBean.configuracionEmail.servidor}"/>

                            <p:outputLabel for="txtPuerto" style="width: 75px;" value="Puerto"/>
                            <p:inputText id="txtPuerto" style="width: 75px;"
                                         value="#{configuracionBackBean.configuracionEmail.puerto}"/>

                            <p:outputLabel for="txtCuenta" value="Cuenta"/>
                            <p:inputText id="txtCuenta" autocomplete="off"
                                         value="#{configuracionBackBean.configuracionEmail.cuenta}"
                                         style="width: 200px;"/>

                            <p:outputLabel for="txtClave" value="Clave"/>
                            <p:password id="txtClave" autocomplete="off" redisplay="true"
                                        value="#{configuracionBackBean.configuracionEmail.clave}"/>

                            <p:commandButton value="Probar Credenciales" style="width: 200px;"
                                             actionListener="#{configuracionBackBean.probarConexion}"
                                             process="@this" icon="fa fa-signal"/>
                            <p:commandButton value="Enviar Correo de Prueba." style="width: 200px;"
                                             actionListener="#{configuracionBackBean.enviarCorreoDePrueba}"
                                             process="@this" icon="fa fa-signal"/>

                        </p:panelGrid>

                    </p:fieldset>

                    <div class="p-grid">
                        <div class="p-col-3">
                            <p:dataTable var="evento" style="padding-top: 20px;"
                                         id="dtEvento"
                                         selectionMode="single"
                                         rowKey="#{evento.toString()}"
                                         selection="#{configuracionBackBean.eventoSelected}"
                                         value="#{configuracionBackBean.eventos}">
                                <p:ajax event="rowSelect" process="@this"
                                        listener="#{configuracionBackBean.onEventoSelected}"
                                        update="formConfiguraciones:tabviewConfiguracion"/>
                                <p:column headerText="Eventos">
                                    <h:outputText value="#{evento.nombre}"/>
                                </p:column>
                            </p:dataTable>
                        </div>
                        <div class="p-col-9">
                            <p:fieldset id="fldCuenta" legend="Datos de la cuenta">
                                <p:panelGrid columns="2" layout="flex"
                                             columnClasses="p-col-3, p-col-8"
                                             contentStyleClass="p-align-baseline ui-fluid">
                                    <p:outputLabel for="txtDestino" value="Destino"/>
                                    <p:inputText id="txtDestino"
                                                 value="#{configuracionBackBean.configuracionEmail.destino}"/>
                                </p:panelGrid>

                                <p:panelGrid columns="2" layout="flex"
                                             columnClasses="p-col-3, p-col-8"
                                             contentStyleClass="p-align-baseline ui-fluid">
                                    <p:outputLabel for="txtCc" value="CC"/>
                                    <p:inputText id="txtCc"
                                                 value="#{configuracionBackBean.configuracionEmail.correoCc}"/>
                                    <p:outputLabel for="txtBcc" value="BCC"/>
                                    <p:inputText id="txtBcc"
                                                 value="#{configuracionBackBean.configuracionEmail.correoBcc}"/>
                                </p:panelGrid>

                                <p:panelGrid columns="2" layout="flex"
                                             columnClasses="p-col-3, p-col-8"
                                             contentStyleClass="p-align-baseline ui-fluid">
                                    <p:outputLabel for="txtAsunto" value="Asunto"/>
                                    <p:inputText id="txtAsunto"
                                                 value="#{configuracionBackBean.configuracionEmail.asunto}"/>
                                    <p:outputLabel for="txtMensaje" value="Mensaje"/>
                                    <p:inputTextarea id="txtMensaje"
                                                     value="#{configuracionBackBean.configuracionEmail.mensaje}"/>
                                </p:panelGrid>
                            </p:fieldset>
                            <div class="ui-g">
                                <div class="ui-g-12 content-align-right">
                                    <p:commandButton
                                            value="#{configuracionBackBean.configuracionEmail.id eq null ? 'Guardar' : 'Aplicar Cambios'}"
                                            process="@this, :formConfiguraciones"
                                            icon="fa fa-2x fa-save"
                                            actionListener="#{configuracionBackBean.saveMailConfiguracion}"
                                            update=":formConfiguraciones"
                                            style="margin: 0.1em"/>
                                    <p:commandButton value="Cancelar" style="margin: 0.1em"
                                                     actionListener="#{configuracionBackBean.cancelar}"
                                                     styleClass="secondary-button"
                                                     icon="fa fa-close"
                                                     update=":formConfiguraciones"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </p:tab>

                <p:tab title="Seguridad">
                </p:tab>

                <p:tab title="Web APIS">
                </p:tab>

            </p:tabView>
        </h:form>


        <p:dialog id="dModalRazon"
                  widgetVar="dModalRazon"
                  modal="true"
                  width="500"
                  height="auto"
                  closeOnEscape="true"
                  closable="false"
                  showHeader="false">
            <h:form id="frmFormRazon">
                <p:panel>
                    <f:facet name="header">
                        <div class="ui-g">
                            <div class="ui-g-5" style="margin: auto">
                                <h4>
                                    <h:outputText value="Razones de baja"/>
                                </h4>
                            </div>
                            <div class="ui-g-7 content-align-right">
                                <p:commandButton value="Guardar razon"
                                                 widgetVar="btnGuardarRazon"
                                                 onclick="PF('btnGuardarRazon').disable();"
                                                 oncomplete="PF('btnGuardarRazon').enable();PF('dModalRazon').hide()"
                                                 icon="fa fa-save"
                                                 process="@this frmFormRazon"
                                                 action="#{configuracionBackBean.guardarRazon}"
                                                 update=":global-message :formConfiguraciones:tabviewConfiguracion"
                                                 style="margin: 0.1em"
                                />
                                <p:commandButton value="Cerrar"
                                                 style="margin: 0.1em"
                                                 process="@this"
                                                 styleClass="secondary-button"
                                                 resetValues="true"
                                                 icon="fa fa-close"
                                                 oncomplete="PF('dModalRazon').hide()"/>
                            </div>
                        </div>
                    </f:facet>

                    <p:panelGrid columns="2" style="width: 100%;height: 100%;margin-top: 0px;border: 0px;">
                        <p:outputLabel value="Razon"/>
                        <p:inputText id="txtRazon" value="#{configuracionBackBean.razon.razon}"
                                     style="width: 100%;"></p:inputText>

                        <p:outputLabel value="Producto Positivo*"/>
                        <p:toggleSwitch id="tgPositivo" value="#{configuracionBackBean.razon.positivo}"/>

                        <p:outputLabel value="Estado"/>
                        <p:toggleSwitch id="tgEstado" value="#{configuracionBackBean.razon.activo}"/>

                    </p:panelGrid>

                </p:panel>
            </h:form>
        </p:dialog>


    </ui:define>
</ui:composition>